# SDN与网络虚拟化的起源与现状

## 文章摘自
范恂毅与张晓和的新书《新一代SDN - VMware NSX网络原理与实践》

## 云计算
- ### 根据NIST（美国国家标准与技术研究院）的说法
只要一个数据中心拥有“快速弹性的架构”和一个“资源池”，可以提供“按需自助服务”且这些服务是“可测量的服务”，而资源池里的服务最终是可以被“宽带接入”访问的，那么它就是一个“云”。

- ### 云计算的特点及优势 
- 资源池化 
- 网络访问 
- 自助式服务 
- 可衡量的服务量（弹性计算、按需计费）
- 资源灵活调度

- ### 云的服务方式分三种
- SaaS 【software as a service】 软件即服务 – 用户通过网络租用基于Web的软件使用。（虚拟桌面，在线游戏等）
- PaaS 【platform as a service】 平台即服务 – 指将软件研发的平台作为一种服务。(数据库，开发工具，web服务器，软件运行环境等) 
- IaaS 【infrastructure as a service】 基础架构即服务 – 用户通过网络直接访问底层的计算、存储和网络资源。(虚拟机，服务器，存储空间，网络带宽等)

- ### 云的部署模式
- 公有云：通常指第三方提供商为用户提供的能够使用的云，公有云的核心属性是共享资源服务。例如：阿里云、腾讯云、百度云等等。
- 私有云：是为一个客户单独使用而构建的，对数据、安全性和服务质量提供最有效控制。私有云可部署在企业数据中心的防火墙内，也可以将它们部署在一个安全的主机托管场所，私有云的核心属性是专有资源。 
- 混合云：融合了公有云和私有云的优点。出于安全考虑，企业更愿意将数据存放在私有云中，但是同时又希望可以获得公有云的计算资源，，混合云达到了既省钱又安全的目的。

## SDN的起源
- 斯坦福大学的博士研究生**马丁·卡萨多**发现问题：当网络管理员需要修改配置或策略时，必须登录每一台设备。但是当网络设备达到几千台，物理服务器达到几万台时，网络管理员该怎么办呢？他的研究课题是实现一个灵活的、能够像计算机一样可编程的网络系统。
- **2004年-2006年**，一个名为**Ethane的网络模型**，这个模型包括了现今SDN架构中的两个重要内容：**基于流表的转发**和**中央控制器**。
- 卡萨多和麦考恩（其导师）研究一款叫做**NOX的控制器**
- 师徒两人着手开发这个**控制器对交换机接口的控制协议**——具有划时代意义的**Openflow协议**就诞生了
- 麦考恩和卡萨多为进一步提出SDN的概念，邀请了加州大学伯克利分校的斯科特·申克（Scott Shenker）教授加入，他们3人于**2007年成立了Nicira公司**
- **2008年3月**，麦考恩在ACM SIGCOMM（ACM组织在通信网络领域的旗舰型会议，也是目前国际通信网络领域的顶尖会议）上发表了著名论文**OpenFlow: Enable Innvations in Campus Network**。
- **OpenFlow的现实意义**：在不改变物理拓扑的情况下，分离控制平面和转发平面，实现网络的集中管理和控制并不影响正常的业务流量。
- **2012年7月**，VMware公司宣布以12.6亿美元收购Nicira公司。目标方针非常清晰——将Nicira的网络虚拟平台解决方案融入自己的服务器虚拟化解决方案**，所有的网络高级功能全部通过服务器内部虚拟化软件完成，硬件网络设备就可以只需要处理转发**。这个解决方案就是NSX网络虚拟化解决方案。

## SDN是什么
- 正如业内很难回答“云计算”的定义是什么一样，业内也很难回答SDN的定义。
- SDN其实并不是一种技术，也不是一种协议，它只是一个体系框架，一种设计理念。
- 当前业内比较认可的SDN的特征属性如下：
1. 控制平面与转发平面分离
2. 开放的可编程接口
3. 集中化的网络控制
4. 网络业务的自动化应用程序控制
- 其中前两点是SDN的核心。如果一个网络系统具备了这两点特征，那么就可以宽泛地认为这是一个SDN架构。

## SDN如何应对当前IT环境
- SDN解决这些问题的核心思想是**改变传统网络中控制数据流的方式**。在传统网络中，报文从源转发到目的的过程中，转发行为是逐条**控制并独立进行配置的**，这种控制也不是统一的。
而SDN是将每台设备里的控制平面剥离出来，放到一个控制器中，由这个**控制器通过统一的指令来集中管理转发路径上的所有设备**。这个控制器知晓整网的拓扑，知晓转发过程中所有的必需信息，而且**上层应用程序**也可以通过控制器提供的API以**可编程**的方式进行控制，这样可以**消除大量手工配置**（无需管理员登录到每一台设备上进行配置），从而大大增加了网络灵活性和可视性，提高了部署和维护效率。

- SDN的应用案例：
1. 一个对外提供服务的托管数据中心，需要增加一个租户，并为这个租户增加一台新的虚拟机。
在SDN环境中，只要管理员将其属性定义好，管理平台就可以自动按照其所需资源进行配置——申请多少内存，申请多大容量的存储空间，虚拟网络和物理网络的路由策略、安全策略、负载均衡策略，都是自动完成的。而这一切的配置都可以通过SDN控制器自动发布到各个设备中。
这样一来，一个业务上线的时间，可能由10小时缩短为10分钟。
如果没有SDN，网络管理员、服务器管理员和存储管理员必须通力合作，在不同的网络设备、服务器虚拟化软件、存储设备上进行逐步配置和资源分配，而且中间还可能会产生错误配置。这也解决了我们之前提到的网络资源无法实现按需自助式服务的问题。  
**（总结：用户弹性增加一台虚机后，SDN方式只需将需求告知控制器，控制器将自动下发路由策略、安全策略、负载均衡策略给各个设备。传统网络则网络管理员、服务器管理员和存储管理员必须通力合作进行手动配置，极容易出错，无法实现按需自助服务）**

2. 此外，SDN还可以更细颗粒度地进行流量优化。Nicira创始人、SDN的提出者卡萨多先生曾经用一个生动的比喻形容数据中心内部的流量：小股数据流构成的突发流量称为“**老鼠流**”，持久且负载较高的稳定流量则称为“**大象流**”。对于数据中心中大多数流量的性能问题，我们都可以将其视为大象踩着老鼠前进的状况，而从用户的角度看，就是持久稳定的流量挤占了小股突发流量的资源。而在SDN的帮助下，系统可以对流量进行智能识别。换句话说，基于SDN的网络系统会辨认出其是否属于大象流，并对这些流量加以优化、标记、识别，确保它不会踩着老鼠前进，这样就达到了大象流和老鼠流的共存。这是因为在SDN架构中，控制器可以知晓全网的拓扑和健康状况。**（总结：传统网络中，大象流不条件挤压老鼠流，SDN网络中，可以识别出大象流和老鼠流，进行分别控制 ）**

## Overlay
Overlay是通过在现有网络上叠加一个虚拟的逻辑网络，让原有网络尽量不做改造，通过定义的逻辑网络来实现业务逻辑，解决原有数据中心的网络问题。实际上就是一种隧道封装技术，将二层网络封装在三层/四层报文中进行传递，提供了一种解决数据平面转发和多租户隔离的技术手段，**VXLAN**（Virtual eXtensible LAN）是当前最为主流的Overlay标准。从数量上讲，它把 12 bit 的 VLAN tag 扩展成了 24 bit。从实现上讲，它是 MAC in UDP的封装方式，可以跨 L3 边界，很巧妙地解决了 GRE tunnel 和 VLAN 存在的不足，让组网变得更加灵活，有很好的扩展性。

## Openstack
OpenStack 是一套框架 - API： 它是一个**中间层**。可以**创建、管理和销毁虚拟机**，但是要完成这些操作需要依赖于第三方的 Hypervisor（管理程序），通过这个 Hypervisor 去完成虚拟化的工作。
### OpenStack基本组件：
- Nova：管理虚拟机的创建和销毁（支持KVM， Xen，VMware ，还支持像 Linux Container 和 Docker 这样轻量级的虚拟化技术）
- Neutron：虚拟网络管理服务，是SDN在 OpenStack 里边的一个实现，提供 Plugin 模块，这个是用户可以自己去写的。
- Cinder：虚拟块存储服务：它需要依赖一个实际的块存储设备的支持，这个设备可以是一个分布式的存储系统，比如说 Ceph。
- Swift：对象存储服务，简单来说，就是虚拟出一块磁盘空间，可以在这个空间当中存放文件，不能进行格式化，转换文件系统，大多应用于云磁盘/文件。
- Keystone：权限认证
- Glance：镜像管理
- Horizon：图形界面，控制面板